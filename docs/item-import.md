# Building Repository Objects from the File Archive



We're initially interested in just two diferent content types:

1. books
1. large image collections


## The File Archive

### File Archive Bags:
1. Each of the bags is for building for an individual islandora content object and is identified by a unique bag folder name. For example, a bag for an islandora book object contains all the original, high-resolution TIFF image files.
1. Each bag also contains an XML metadata file that contains all the metadata information for the TIFF file(s). For example, a book bag may contain the metadata file page.xml for the TIFF files. 
1. If a bag contains multiple TIFF files, these files have alphanumerically ordered names to generated the pages of books in a correct order. 
1. The islandora object metadata file (e.g., islandora book object) is also included in the bags.


## Importing a Book from the File Archive

Here's our general plan for how importing a book should work. Currently
ignoring the existence of Amazon Glacier, and the desire to changelog the
bags.

1. DigiLab scans a book to produce a set of tiffs and notes page-level descriptive metadata
1. DigiLab bags tiffs for export to file archive
1. File Archive extracts page level metadata to xml
1. File Archive rebags with page level metadata
1. Repository Services is given a bag path and catalog id and then:
  * exports metadata from the catalog and exhibit site to the bag path
  * generates UUIDs for the book and for each page of the book
  * generates an import recipe file that includes those UUIDs
1. File Archive rebags with the files generated in previous step
1. Repository Services builds a repository object based on the recipe provided by the mapfile, accessing bag contents from the File Archive via http


### Recipe Files

For books, we'd expect a JSON recipe to look something like:

 
 ```json
 {
    "receipe": {
        "import": "book",
        "uuid": "ba8d9603-14d5-4cb8-8f61-8ddaca9e6be0",
        "metadata": {
            "marcxml": "book.xml",
            "pagemeta": "page.xml"
        },
        "pages": [
            [
                "page1.tiff",
                "00e261a7-8531-4b08-a331-a8730c29e6c2"
            ],
            [
                "page2.tiff",
                "cc8f6120-43a2-4724-a34f-25293f82ea43"
            ],
            [
                "page3.tiff",
                "8a655bb5-2ff3-4f6c-acef-68baedb87070"
            ],
            [
                "page4.tiff",
                "c553c267-bcba-4ddb-b9bb-0fe45ab2c3aa"
            ]
        ]
    }
}
```

## Object Creation Details

We currently conceive object creation as a command line process where the interface would look something like
```
drush import-function-name $bag-uri
```
We may also want to specify a parent for the object to be created, but that could also be part of the item recipe. 

### Initial requirements for import
1. The importing logic has to be applicable or easily extendable to other islandora content models for future use.
1. The importing process has to have correct exception handling system, reporting specified errors and preventing system from collapse or other misconducts.
1. The importing should be a transactional process, which means the importing can never be partially complete. The already imported files will be cleaned up if the import fails.
1. After each conducted import, there should be a report generated.
1.  In the rare cases of updating/deleting islandora content object pages, we can add/change/delete page images and the page numbers are also updated correspondly (Maybe implemented in the future).


### Import Report:

 

1. Import success or not.
2. Import completion date and time.
3. If the import fails:
  * Reasons of failing;
  * List of the files already imported, each of which should be identified by its file name and the UUID, if applicable, used in the bag, together withe the generated Islandora ID.
  * In addition, indication if the imported files have been cleaned up (deleted from the Islandora box).
4. If the import succeeds:
  * New Islandora object information.
  * List of the imported files, accompanied by the informaiton of original file name, UUID (if applicable), and the generated Islandora ID.
  * Results of running the checksum verificaiton.

# Sample Bagit Import Report
1. Import time: 04-09-2015, 5:30pm
2. New Islandora book object islandora:131 has been successfully generated from Bag 5678 (UUID 679dsfhg-sdfds), with 6 pages.
3. The list of the pages generated by this import:
  * page 1, file name: page1.TIFF; UUID: hdskd8485-dsfhl; islandora ID: islandora:132;
  * page 2, file name: page2.TIFF; UUID: hdskd8dfs-dsfds; islandora ID: islandora:133;
  * page 3, file name: page3.TIFF; UUID: hdskd8485-dsfhl; islandora ID: islandora:134;
  * page 4, file name: page4.TIFF; UUID: hdskd8485-dsfhl; islandora ID: islandora:135;
  * page 5, file name: page5.TIFF; UUID: hdskd8485-dsfhl; islandora ID: islandora:136;
  * page 6, file name: page6.TIFF; UUID: hdskd8485-dsfhl; islandora ID: islandora:137;
4. Checksum verification:
  * page 1: successful;
  * page 2: successful;
  * page 3: successful;
  * page 4: successful;
  * page 5: successful;
  * page 6: successful;
